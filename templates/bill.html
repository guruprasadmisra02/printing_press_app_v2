{% extends 'base.html' %}
{% block content %}

<style>
  @media print {
    .no-print, nav.navbar, footer { display: none !important; }
    body { background: #fff; }
    .container { box-shadow: none !important; border: none !important; }
    @page { size: A4; margin: 12mm; }
    .editable { border-bottom: 1px dashed transparent !important; }
    .hide-when-empty[data-empty="true"] { display: none !important; }
  }
  .editable { padding: 2px 4px; border-bottom: 1px dashed #bbb; cursor: text; }
  .editable:focus { outline: 2px solid rgba(13,110,253,.25); border-bottom-color: transparent; }
  small.hint { color: #6c757d; font-size: 12px; }
</style>

<div class="container my-4 p-4 bg-white shadow rounded">
  <div class="text-center mb-4">
    <h2 class="text-primary fw-bold">ANANTA BALIA PRINTERS & PUBLISHERS</h2>
    <p class="mb-1">Plot No. 523, Mahanadi Vihar, Cuttack ‚Äì 753004</p>
    <p class="mb-0">üìû 9937043648 &nbsp; | &nbsp; üìß pkmisctc17@gmail.com</p>
    <hr>
    <h4 class="text-secondary">Customer Bill</h4>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <strong>Bill No:</strong> {{ order.id }}<br>
      <strong>Date:</strong> {{ order.date }}
    </div>
    <div class="col-md-6 text-md-end mt-2 mt-md-0">
      <div><strong>Customer:</strong>
        <span id="custName" class="editable" contenteditable="true">
          {{ order.customer_name or order.user_name or 'Enter customer name' }}
        </span>
      </div>
      <div id="gstRow" class="hide-when-empty" data-empty="true">
        <strong>GSTIN:</strong>
        <span id="gstin" class="editable" contenteditable="true" placeholder="Enter GSTIN"></span>
      </div>
      <small class="hint no-print d-block mt-1">Tip: Click name/GSTIN to edit before printing</small>
    </div>
  </div>

  <table class="table table-bordered mt-3">
    <thead class="table-primary">
      <tr>
        <th>Product Name</th>
        <th style="width:120px">Quantity</th>
        <th style="width:180px">Total Cost (‚Çπ)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ order.product_name }}</td>
        <td>{{ order.quantity }}</td>
        <td>{{ order.total_cost or 0 }}</td>
      </tr>
    </tbody>
  </table>

  <div class="text-end mt-4">
    <h5 class="mb-0"><strong>Grand Total:</strong> ‚Çπ {{ order.total_cost or 0 }}</h5>
  </div>

  <div class="text-center mt-4 no-print">
    <button class="btn btn-outline-primary me-2" onclick="handlePrint()">üñ®Ô∏è Print Bill</button>
    <a href="{{ url_for('owner_orders') if session.role == 'owner' else url_for('worker_orders') }}" class="btn btn-secondary">Back</a>
  </div>

  <hr class="mt-5">
  <p class="text-center text-muted small mb-0">
    Thank you for choosing <strong>Ananta Balia Printers & Publishers</strong>.
  </p>
</div>

<script>
  function refreshGstVisibility() {
    const gst = document.getElementById('gstin');
    const row = document.getElementById('gstRow');
    const value = (gst.innerText || '').trim();
    row.setAttribute('data-empty', value.length ? 'false' : 'true');
  }
  function handlePrint() { refreshGstVisibility(); window.print(); }
  document.addEventListener('input', function(e) {
    if (e.target && e.target.id === 'gstin') refreshGstVisibility();
  });
  document.addEventListener('DOMContentLoaded', refreshGstVisibility);
</script>

{% endblock %}
